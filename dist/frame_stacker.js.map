{"version":3,"sources":["layer_manager.js","plugins/with_default_plugin.js","plugins/auto_sizing.js","plugins/auto_centering_layer.js","polyfills/element_closest.js","addDelegatedEventListener.js","plugins/draggable.js","plugins/edge_snapping_layer.js","plugins/edge_snapping_buttons.js","plugins/exit_on_escape.js","plugins/focus_management.js","plugins/full_layer.js","plugins/shadow_border.js","frame_stacker.js"],"names":["get_container","c","document","querySelector","createElement","body","append","get_iframes","querySelectorAll","get_unresolved_iframes","Array","prototype","slice","call","filter","iframe","_frame_stacker","resolved","scroll_locking_layers_count","scrollTop","scrollLeft","fix_scroll","documentElement","on_iframe_click","clicked_iframe","event","iframes","i","length","preventDefault","stopPropagation","exit_on_external_click","resolve","push","url","create","on_created","on_load","on_covered","on_resumed","lock_scroll","on_resolve","remove","active_iframes","current_top","addEventListener","promise","Promise","reject","e","first_load","w","contentWindow","frame_stacker","window","contentDocument","bind","src","focus","value","pop","removeEventListener","next_top","plugin_maker_function","default_plugin","k","get_interior_border_width","computed_style","boxSizing","Math","ceil","parseFloat","borderLeftWidth","paddingLeft","paddingRight","borderRightWidth","get_interior_border_height","borderTopHeight","paddingTop","paddingBottom","borderBottomHeight","fix_size","width","height","body_style","iframe_style","adjust_overflowy","required_height","offsetHeight","style","overflows","parseInt","overflowY","vertical_scrollbar_width","innerWidth","offsetWidth","marginLeft","marginRight","watch","getComputedStyle","doc","display","bound_fix_size","MutationObserver","observe","attributes","childList","subtree","make_spacer","grow","s","flexGrow","wapper_padding","bottom_grow","container","appendChild","padding","maxWidth","parentElement","removeChild","Element","matches","msMatchesSelector","webkitMatchesSelector","closest","el","parentNode","nodeType","target","selector","type","listener","options","matched_target","drag_selector","get_position","touches","x","screenX","y","screenY","clamp","min","max","get_translation","element","t","m","transform","match","set_translation","iw","is_dragging","initial_event_position","initial_translation","max_move_x","min_move_x","max_move_y","min_move_y","on_move_start","isDefault","rect","getBoundingClientRect","left","ownerDocument","clientWidth","right","top","clientHeight","bottom","on_move","p","move_x","move_y","on_move_end","make_snapper","screen_fraction","get_width","get_height","initial_side","snapper","frame_stacker_edge_snapper","opacity","d","b","insertBefore","firstElementChild","outerHTML","key","compare_tab_order","a","tabIndex","dom_order","get_focusable_elements","all_elements","focusable_elements","items","map","sort","focus_wrap","keydown_event","default_prevented","altKey","ctrlKey","metaKey","view","elements","last","first","current","activeElement","shiftKey","autofocus_target","_frame_stacker_focus_management_previous_parent_active_element","_frame_stacker_focus_management_previous_active_element","border","borderRadius","boxShadow","execute_all","plugins","function_name","functions","plugin","Boolean","apply","arguments","console","error","get_first_defined","property","combine_plugins","validate","Error","focus_management","concat","layer_manager","full_layer","auto_layer","auto_centering_layer","auto_sizing","shadow_border","edge_snapping_layer","draggable","easy_exit","exit_on_escape","edge_snapping_buttons"],"mappings":"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","file":"frame_stacker.js","sourceRoot":"../src","sourcesContent":["/*\n\tlayer_manager.js\n\n\tThis module is responsible for managing the push/pop of iframe layers, and calling layer callbacks at appropriate times.\n\n\tWe try to implement as few \"features\" here as possible, leaving those to plugins. Certain features (locks_scroll, exit_on_external_click) require knowlegde about all layers, however, so we have to manage them here.\n*/\nfunction get_container() {\n\tvar c = document.querySelector('frame-stacker-container');\n\tif (!c) {\n\t\tc = document.createElement('frame-stacker-container');\n\t\tdocument.body.append(c);\n\t}\n\t// TODO - if not at end of body, and no attribute 'frame-stacker-container-fixed', then move to end of body\n\t// This is necessary so that layering order is independent of \"widget open order\"\n\treturn c;\n}\nfunction get_iframes() {\n\t/*\n\t\tNote - we intentionally use DOM as source of truth here.\n\t\tAn iframe \"exists\" until it is removed from DOM.\n\t\tWhen we call remove(iframe), it may not be removed synchronously, and we still need to treat it as a layer (ie. if the user clicks on it while it's animating out, we shouldn't start popping other layers underneath it).\n\t*/\n\treturn document.querySelectorAll('frame-stacker-container iframe');\n}\nfunction get_unresolved_iframes() {\n\treturn Array.prototype.slice.call(\n\t\tget_iframes()\n\t).filter(function(iframe) {\n\t\treturn !iframe._frame_stacker.resolved;\n\t});\n}\n\nlet scroll_locking_layers_count = 0;\nlet scrollTop = null;\nlet scrollLeft = null;\nfunction fix_scroll() {\n\tdocument.documentElement.scrollTop = scrollTop;\n\tdocument.documentElement.scrollLeft = scrollLeft;\n}\n\nfunction on_iframe_click(clicked_iframe, event) {\n\t// if there are any layers above this iframe, cancel the event\n\t// pop the top-most contiguous iframes above the iframe which set exit_on_external_click\n\n\tconst iframes = get_iframes();\n\t// Intentionally iterate over iframes in reverse\n\t// Stop as soon as we find the iframe that was clicked \n\t// (do NOT execute loop body for that iframe)\n\tfor (\n\t\tlet i = iframes.length - 1; \n\t\ti >= 0 && iframes[i] != clicked_iframe; \n\t\ti--\n\t) {\n\t\tconst iframe = iframes[i];\n\n\t\t// At this point, we know there was at least one iframe above the iframe that was clicked. Swallow the click event.\n\t\t// Notice - if there are mutliple layers open, we might end up calling these multiple times - but that's okay\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\t// This iframe has already been resolved, and in the process of being removed from the DOM\n\t\tif (iframe._frame_stacker.resolved) continue\n\n\t\tif (iframe._frame_stacker.exit_on_external_click) {\n\t\t\tresolve();\n\t\t}\n\t\telse {\n\t\t\t// This layer doesn't exit_on_external_click, so don't pop any more layers\n\t\t\tbreak;\n\t\t}\n\t}\n}\ndocument.addEventListener('click', on_iframe_click.bind(null, null), true);\n\nexport function push(url, {\n\tcreate,\n\ton_created,\n\ton_load,\n\ton_covered,\n\ton_resumed,\n\texit_on_external_click,\n\tlock_scroll,\n\ton_resolve,\n\tremove\n}) {\n\tconst active_iframes = get_unresolved_iframes();\n\tconst current_top = active_iframes[active_iframes.length-1];\n\tif (current_top) {\n\t\tcurrent_top._frame_stacker.on_covered(current_top);\n\t}\n\n\tif (lock_scroll) {\n\t\tscroll_locking_layers_count += 1\n\t\tscrollTop = document.documentElement.scrollTop;\n\t\tscrollLeft = document.documentElement.scrollLeft;\n\t\taddEventListener('scroll', fix_scroll);\n\t}\n\n\tconst iframe = create(get_container());\n\ton_created(iframe);\n\tiframe._frame_stacker = {\n\t\ton_covered: on_covered,\n\t\ton_resumed: on_resumed,\n\t\texit_on_external_click: exit_on_external_click,\n\t\tlock_scroll: lock_scroll,\n\t\ton_resolve: on_resolve,\n\t\tremove: remove,\n\t\tresolved: false,\n\t}\n\tlet promise;\n\ttry {\n\t\tpromise = new Promise(\n\t\t\tfunction(resolve, reject) {\n\t\t\t\tiframe._frame_stacker.resolve = resolve;\n\t\t\t}\n\t\t)\n\t}\n\tcatch(e) {}\n\n\tlet first_load = true;\n\tiframe.addEventListener('load', function() {\n\t\tconst w = iframe.contentWindow;\n\t\t/*\n\t\t\tMake frame_stacker available inside the iframe, even if it didn't include the script\n\n\t\t\tPatch the object so that push() and resolve() act on the \"root window\".\n\n\t\t\tIntentionally do NOT overwrite the entire object. If the child page includes a different version of frame_stacker with different plugins available, it should still be able to use those.\n\t\t*/\n\t\tw.frame_stacker = w.frame_stacker || window.frame_stacker;\n\t\tw.frame_stacker.push = window.frame_stacker.push;\n\t\tw.frame_stacker.resolve = window.frame_stacker.resolve;\n\n\t\t// These are required for implementing \"exit_on_external_click\"\n\t\tiframe.contentDocument.addEventListener('click', on_iframe_click.bind(null, iframe), true);\n\n\t\ton_load(iframe, first_load);\n\t\tfirst_load = false;\n\t});\n\n\tiframe.src = url;\n\tiframe.focus();\n\n\treturn promise;\n}\nexport function resolve(value) {\n\t/*\n\t\treminder - calling remove(iframe) may not remove it from the DOM immediately. We need to look at only those that have not already been removed.\n\t*/\n\tconst iframes = get_unresolved_iframes();\n\n\tconst iframe = iframes.pop();\n\tif (!iframe) return;\n\tiframe._frame_stacker.resolved = true;\n\n\tif (iframe._frame_stacker.lock_scroll) {\n\t\tscroll_locking_layers_count--;\n\t\tif (scroll_locking_layers_count == 0) {\n\t\t\tremoveEventListener('scroll', fix_scroll);\n\t\t}\n\t}\n\n\tif (iframe._frame_stacker.resolve) {\n\t\tiframe._frame_stacker.resolve(value);\n\t}\n\tiframe._frame_stacker.on_resolve(value, iframe);\n\tiframe._frame_stacker.remove(iframe, get_container());\n\n\tconst next_top = iframes.pop();\n\tif (!next_top) return\n\tnext_top._frame_stacker.on_resumed(next_top);\n}","/*\n\tGiven a function which creates a plugin, invoke that function with no arguments.\n\tCopy all properties from the resulting plugin to the function, so that the function can be used directly as a plugin.\n\n\tplugin_maker_function must have default values for all arguments.\n*/\nexport default function(plugin_maker_function) {\n\tconst default_plugin = plugin_maker_function();\n\tfor (let k in default_plugin) plugin_maker_function[k] = default_plugin[k];\n\treturn plugin_maker_function;\n}","import with_default_plugin from './with_default_plugin.js';\n\nfunction get_interior_border_width(computed_style) {\n\tif (computed_style.boxSizing != 'border-box') return 0\n\treturn Math.ceil(\n\t\tparseFloat(computed_style.borderLeftWidth) +\n\t\tparseFloat(computed_style.paddingLeft) +\n\t\tparseFloat(computed_style.paddingRight) +\n\t\tparseFloat(computed_style.borderRightWidth)\n\t);\n}\nfunction get_interior_border_height(computed_style) {\n\tif (computed_style.boxSizing != 'border-box') return 0\n\treturn Math.ceil(\n\t\tparseFloat(computed_style.borderTopHeight) +\n\t\tparseFloat(computed_style.paddingTop) +\n\t\tparseFloat(computed_style.paddingBottom) +\n\t\tparseFloat(computed_style.borderBottomHeight)\n\t);\n}\nfunction fix_size(iframe, width, height, document, body_style, iframe_style, adjust_overflowy) {\n\tlet is_limited = false;\n\tif (height) {\n\t\tconst required_height = Math.ceil(document.documentElement.offsetHeight) + get_interior_border_height(iframe_style);\n\t\tiframe.style.height = required_height + 'px';\n\n\t\t/*\n\t\t\tWith this turned off, if you smoothly adjust the document height, then you run into issues.\n\t\t\tAs soon as you increase height, before we can adjust the iframe, a vertical scroll bar will appear.\n\t\t\tThis can cause body content to wrap and make height increase.\n\t\t\tThe result is rather unstable/jittering size adjustments.\n\n\t\t\tSetting overflow-y on the document may have unintended consequences, so we allow the user to turn this feature off.\n\t\t*/\n\t\tif (adjust_overflowy) {\n\t\t\tconst overflows = parseInt(iframe_style.height) < required_height;\n\t\t\tdocument.documentElement.style.overflowY = overflows ? 'scroll' : 'hidden';\n\t\t}\n\t}\n\tif (width) {\n\t\tconst vertical_scrollbar_width = iframe.contentWindow.innerWidth - document.documentElement.offsetWidth;\n\t\tiframe.style.width = (\n\t\t\tMath.ceil(\n\t\t\t\tvertical_scrollbar_width +\n\t\t\t\tparseFloat(body_style.marginLeft) +\n\t\t\t\tparseFloat(body_style.marginRight) +\n\t\t\t\tparseFloat(body_style.width)\n\t\t\t) + get_interior_border_width(iframe_style)\n\t\t) + 'px';\n\t}\n}\n\nexport default with_default_plugin(function({\n\twidth=true,\n\theight=true,\n\twatch=true,\n\tadjust_overflowy=true,\n}={}) {\n\tlet iframe_style;\n\treturn {\n\t\ton_created: function(iframe) {\n\t\t\tiframe_style = getComputedStyle(iframe);\n\t\t},\n\t\ton_load: function(iframe) {\n\t\t\tconst doc = iframe.contentDocument;\n\n\t\t\tif (width) {\n\t\t\t\t/*\n\t\t\t\t\tWe compute iframe width based on body width\n\t\t\t\t\tNormally, body expands to entire window.\n\t\t\t\t\t\n\t\t\t\t\tWith display: inline-block, body will have width determined by content. It seems to have no negative side effects.\n\n\t\t\t\t\tYou are still free to set width/min-width/max-width on the body element.\n\n\t\t\t\t\tNote - if we find negative side effects of this style, we can also experiment with:\n\t\t\t\t\t\thtml{display: flex;}\n\t\t\t\t\tWe could leave this up to the end-user, but I think we should try to provide a default behaviour that covers most cases. End-user can always overwrite in CSS with !important,\n\t\t\t\t\tor they can add another plugin that overwrites this style after us.\n\t\t\t\t*/\n\t\t\t\tdoc.body.style.display = 'inline-block';\n\n\t\t\t\t/*\n\t\t\t\t\tOn every load, \"re-maximize\" the iframe's width before we compute body width.\n\n\t\t\t\t\tOtherwise, if the iframe was previously narrow, and then we loaded a page with a long run of phrasing content, that content wouldn't cause the body to expand. The content would just wrap, and we'd have a tall, narrow iframe.\n\n\t\t\t\t\tNote that we don't do this \"re-maximize\" step when we detect DOM mutations - that seems too costly. If you want dynamically added phrasing content to cause the iframe to grow in width, you'll have to set \"white-space: nowrap;\" on it.\n\t\t\t\t*/\n\t\t\t\tiframe.style.width = '100%';\n\t\t\t}\n\t\t\t/*\n\t\t\t\tgetComputedStyle returns a live object - properties are updated if element's style attribute is updated, stylesheets are changed, etc.\n\n\t\t\t\twidth/margin values are always returned in pixel units, even if set via relative units, viewport units, etc.\n\n\t\t\t\tI'm assuming getComputedStyle is somewhat expensive, so don't call unless we're actually setting iframe width\n\t\t\t*/\n\t\t\tconst body_style = width ? getComputedStyle(doc.body) : null;\n\t\t\tconst bound_fix_size = fix_size.bind(null, iframe, width, height, doc, body_style, iframe_style, adjust_overflowy);\n\n\t\t\tbound_fix_size();\n\n\t\t\t/*\n\t\t\t\tchild window can fire this event any time it's size might have changed\n\n\t\t\t\tmainly useful if you don't want to use our watch feature\n\t\t\t*/\n\t\t\tiframe.contentDocument.addEventListener('frame-stacker-should-resize', bound_fix_size);\n\n\t\t\t/*\n\t\t\t\tThis will catch any DOM mutation on the entire document element.\n\t\t\t\tThis may lead to perfomance issues on pages with rapid DOM mutations (animations, drag and drop, etc.).\n\t\t\t\tFor such pages, you might have to set watch to false.\n\t\t\t*/\n\t\t\tif (watch) {\n\t\t\t\tconst observer = new MutationObserver(bound_fix_size);\n\t\t\t\tobserver.observe(\n\t\t\t\t\tiframe.contentDocument.documentElement,\n\t\t\t\t\t{attributes: true, childList: true, subtree: true},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});","/*\nCreates an iframe inside of a flexbox wrapper item.\n\nKeeps the iframe centered horizontally.\nVertical centering is more complex -> when the iframe is small, we push it closer to the top of the window. I think this looks better/more balanced than having it dead-center. It makes sense, when you compare to alert(), whose pop-up is bascially at the top of the page all the time.\n\nDoes not set the size of the iframe in any way. \nFor most use cases, you can combine with auto_sizing. ALternatively, you can set explicit width/height in the on_created callback.\n*/\nimport with_default_plugin from './with_default_plugin.js';\n\nfunction make_spacer(grow) {\n    const s = document.createElement('div');\n    s.style.flexGrow = grow;\n    return s;\n}\nexport default with_default_plugin(function({\n    wapper_padding='10px',\n    bottom_grow=5,\n}={}) {\n    return {\n        create: function(container) {\n            const w = document.createElement('div');\n            container.appendChild(w);\n            w.style = `\n                position: absolute;\n                left: 0;right: 0;top: 0;bottom: 0;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n            `;\n            w.style.padding = wapper_padding;\n            w.appendChild(make_spacer(1));\n            const iframe = document.createElement('iframe');\n            iframe.style.maxWidth = '100%';\n            w.appendChild(iframe);\n            w.appendChild(make_spacer(bottom_grow));\n            return iframe\n        },\n        remove: function(iframe) {\n            const w = iframe.parentElement;\n            w.parentElement.removeChild(w);\n        },\n    };\n});\n","// https://developer.mozilla.org/en-US/docs/Web/API/Element/closest\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector || \n                              Element.prototype.webkitMatchesSelector;\n}\nif (!Element.prototype.closest) {\n  Element.prototype.closest = function(s) {\n    var el = this;\n\n    do {\n      if (el.matches(s)) return el;\n      el = el.parentElement || el.parentNode;\n    } while (el !== null && el.nodeType === 1);\n    return null;\n  };\n}","import './polyfills/element_closest.js';\n/*\nWorks like jQuery's .on\n*/\nexport default function(target, selector, type, listener, options) {\n    target.addEventListener(type, function(event) {\n        const matched_target = event.target.closest(selector);\n        if (!matched_target) return\n        listener.call(matched_target, event);\n    }, options);\n}","/*\nMake an iframe draggable within the parent window.\n\nWe listen (on the window) to any mousedown/touchstart interactions on elements with the window-layer-drag-handle attribute. You can set this on the body element if you want to be able to drag the iframe from any part of it.\n\nIframe is bounded to stay within the viewport of parent window.\n\nWe use transform to move the iframe, so it doesn't matter how it is initially positioned (absolute, inside a flex container, etc.)\n\nYou can set the transform on the iframe to animate it in/out, but otherwise this must be the only plugin manipulating the iframe's transform.\n\n\nTODO\n--------------------------------------------------------\nadd \"move commands\" to the window, so users can implement keyboard friendly movement buttons\n(maybe we should listen to arrow key input on [frame-stacker-drag-target]? might not want to do that if target is body, though)\nmake clamp optional\nadd \"clamp margin\" option - can be positive or negative - decreases or increases clamp area\n*/\nimport addDelegatedEventListener from '../addDelegatedEventListener.js';\nconst drag_selector = '[frame-stacker-drag-target]';\nfunction get_position(event) {\n    return (event.touches ? {\n        x: event.touches[0].screenX,\n        y: event.touches[0].screenY,\n    } : {\n        x: event.screenX,\n        y: event.screenY,\n    });\n}\nfunction clamp(value, min, max) {\n    if (value < min) return min\n    if (value > max) return max\n    return value\n}\nfunction get_translation(element) {\n    const t = element.style.transform;\n    const m = t.match(/translate\\((-?[\\d.]+)px, (-?[\\d.]+)px\\)/)\n    if (!m) return {x: 0, y: 0}\n    return {x: parseFloat(m[1]), y: parseFloat(m[2])}\n}\nfunction set_translation(element, x, y) {\n    element.style.transform = `translate(${x}px, ${y}px)`;\n}\nexport default {\n    on_load: function(iframe) {\n        const iw = iframe.contentWindow;\n\n        let is_dragging = false;\n        let initial_event_position = null;\n        let initial_translation = null;\n        let max_move_x = null;\n        let min_move_x = null;\n        let max_move_y = null;\n        let min_move_y = null;\n        function on_move_start(event) {\n            if (event.isDefault)\n\n            event.preventDefault();\n\n            is_dragging = true;\n            initial_event_position = get_position(event);\n            initial_translation = get_translation(iframe);\n\n            const rect = iframe.getBoundingClientRect();\n            min_move_x = -rect.left;\n            max_move_x = iframe.ownerDocument.documentElement.clientWidth - rect.right;\n            min_move_y = -rect.top;\n            max_move_y = iframe.ownerDocument.documentElement.clientHeight - rect.bottom;\n        }\n        function on_move(event) {\n            if (!is_dragging) return\n            event.preventDefault();\n            const p = get_position(event);\n            const move_x = clamp(p.x-initial_event_position.x, min_move_x, max_move_x);\n            const move_y = clamp(p.y-initial_event_position.y, min_move_y, max_move_y);\n            set_translation(\n                iframe, \n                initial_translation.x + move_x,\n                initial_translation.y + move_y\n            );\n        }\n        function on_move_end() {\n            is_dragging = false;\n        }\n\n        addDelegatedEventListener(iw, drag_selector, 'mousedown', on_move_start);\n        addDelegatedEventListener(iw, drag_selector, 'touchstart', on_move_start);\n        iw.addEventListener('mousemove', on_move);\n        iw.addEventListener('touchmove', on_move);\n        iw.addEventListener('mouseup', on_move_end);\n        iw.addEventListener('touchend', on_move_end);\n        iw.addEventListener('touchcancel', on_move_end);\n    }\n};","/*\nImplements an overlay which occupies a fixed portion of the screen area, and which is always locked to one edge of the screen.\n\nAdds a \"frame_stacker_edge_snapper\" object to the iframe window (with left(), right(), top(), bottom() methods), so that the inner page can snap itself.\n\nUse plugins/edge_snapping_buttons.js to implement a basic UI for invoking these commands, or create your own.\n*/\n\nimport with_default_plugin from './with_default_plugin.js';\n\nfunction make_snapper(iframe, screen_fraction) {\n    // compute these, rather than caching, in case outer window size changes\n    function get_width() {\n        return screen_fraction * iframe.parentElement.clientWidth + 'px';\n    }\n    function get_height() {\n        return screen_fraction * iframe.parentElement.clientHeight + 'px';\n    }\n\n    const s = iframe.style;\n    return {\n        left: function() {\n            s.width = get_width();\n            s.left = 0;\n            s.right = '';\n            s.height = '100%';\n            s.top = 0;\n            s.bottom = 0;\n        },\n        right: function() {\n            s.width = get_width();\n            s.right = 0;\n            s.left = '';\n            s.height = '100%';\n            s.top = 0;\n            s.bottom = 0;\n        },\n        top: function() {\n            s.width = '100%';\n            s.left = 0;\n            s.right = 0;\n            s.height = get_height();\n            s.top = 0;\n            s.bottom = '';\n        },\n        bottom: function() {\n            s.width = '100%';\n            s.left = 0;\n            s.right = 0;\n            s.height = get_height();\n            s.top = '';\n            s.bottom = 0;\n        },\n    }\n}\nexport default with_default_plugin(function({\n    screen_fraction=0.4,\n    initial_side='bottom',\n} = {}) {\n    return {\n        create: function(container) {\n            const i = document.createElement('iframe');\n            container.appendChild(i);\n            i.style = `position: absolute; opacity: 0;`;\n            return i;\n        },\n        on_load: function(iframe, first_load) {\n            const snapper = make_snapper(iframe, screen_fraction);\n            iframe.contentWindow.frame_stacker_edge_snapper = snapper;\n            if (first_load) {\n                snapper[initial_side]();\n                iframe.style.opacity = 1;\n            }\n        },\n        remove: function(iframe) {\n            iframe.parentElement.removeChild(iframe);\n        }\n    }\n});","/*\nAdds a basic \"edge snapping toolbar\" to the beginning of the body, for use with edge_snapping_layer\n*/\nexport default {\n    on_load: function(iframe) {\n        const d = document.createElement('div');\n        const b = iframe.contentDocument.body;\n        b.insertBefore(d, b.firstElementChild);\n        d.outerHTML = `\n            <div class=\"EdgeSnapperBar\">\n                <button onclick=\"frame_stacker_edge_snapper.left()\">⇦</button>\n                <button onclick=\"frame_stacker_edge_snapper.top()\">⇧</button>\n                <button onclick=\"frame_stacker_edge_snapper.bottom()\">⇩</button>\n                <button onclick=\"frame_stacker_edge_snapper.right()\">⇨</button>\n            </div>\n        `;\n    }\n}","// Add a listener inside the iframe that pops the layer whenever the user hits the escape the key\nexport default {\n\ton_load: function(iframe) {\n\t\tiframe.contentWindow.addEventListener('keydown', function(e) {\n\t\t\tif (e.key != 'Escape') return\n\t\t\tframe_stacker.resolve();\n\t\t});\n\t},\n};","/*\n    TODO - \"focus steal\" - while topmost, if the iframe blurs, restore focus\n    This is to handle the case where focus left the iframe through some unforeseen circumstance (ie. Vimium)\n    Maybe we shouldn't worry about that, though?\n*/\n\nfunction compare_tab_order(a, b) {\n    if (a.element.tabIndex < b.element.tabIndex) {\n        return -1;\n    }\n    if (a.element.tabIndex > b.element.tabIndex) {\n        return 1;\n    }\n    return a.dom_order - b.dom_order;\n}\nfunction get_focusable_elements(body) {\n    // return array of all keyboard-focusable elements, in standard focus order\n    const all_elements = body.querySelectorAll('*');\n    const focusable_elements = [];\n    const length = all_elements.length;\n    for (let i = 0; i < length; i++) {\n        if (all_elements[i].tabIndex >= 0) focusable_elements.push(all_elements[i]);\n    }\n\n    const items = focusable_elements.map((e, i) => ({element: e, dom_order: i}));\n    items.sort(compare_tab_order);\n    return items.map(x => x.element);\n}\nfunction focus_wrap(keydown_event) {\n    // Note - keydown_event may have occurred in any window, not necessarily the one executing this code\n    if (keydown_event.default_prevented) return\n    if (keydown_event.key != 'Tab') return\n    if (keydown_event.altKey || keydown_event.ctrlKey || keydown_event.metaKey) return\n\n    const doc = keydown_event.view.document;\n    const elements = get_focusable_elements(doc.body);\n    const last = elements[elements.length-1];\n    const first = elements[0];\n    const current = doc.activeElement;\n\n    // Notice - we only handle the case where focus should wrap - otherwise we let the default action occur\n    if (current == last && !keydown_event.shiftKey) {\n        first.focus();\n        keydown_event.preventDefault();\n    }\n    else if (current == first && keydown_event.shiftKey)  {\n        last.focus();\n        keydown_event.preventDefault();\n    }\n}\n\nexport default {\n    on_load: function(iframe) {\n        // focus first element with [autofocus]\n        const doc = iframe.contentDocument;\n        const autofocus_target = doc.querySelector('[autofocus]');\n        autofocus_target && autofocus_target.focus();\n\n        // Tab key - wrap focus within the iframe\n        iframe.contentWindow.addEventListener('keydown', focus_wrap);\n    },\n\n    // This pair of function is responsible for restoring focus in the root_window\n    // Note that the stored element may be a different iframe, which will have it's own activeElement\n    // We don't do a \"deep\" restore, in case that other iframe is cross origin (in which case, we can't read it's activeElement)\n    on_created: function(iframe) {\n        iframe._frame_stacker_focus_management_previous_parent_active_element = document.activeElement;\n    },\n    on_resolve: function(value, iframe) {\n        iframe._frame_stacker_focus_management_previous_parent_active_element.focus();\n    },\n\n    // This pair of functions is responsible for restoring focus within ourselves after we push another window layer\n    // It does not work with cross origin iframes\n    on_covered: function(iframe) {\n        iframe._frame_stacker_focus_management_previous_active_element = iframe.contentDocument.activeElement;\n    },\n    on_resumed: function(iframe) {\n        iframe._frame_stacker_focus_management_previous_active_element.focus();\n    },\n}","export default {\n\tcreate: function(container) {\n\t\tvar iframe = document.createElement('iframe');\n\t\tiframe.style = `\n\t\t\topacity: 0;\n\t\t\tdisplay: block;\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\twidth: 100%;\n\t\t\theight: 100%;\n\t\t\tborder: none;\n\t\t`;\n\t\tcontainer.appendChild(iframe);\n\t\treturn iframe;\n\t},\n\ton_load: function(iframe, first_load) {\n\t\tif (first_load) iframe.style.opacity = '1';\n\t},\n\tlock_scroll: true,\n\tremove: function(iframe, container) {\n\t\tcontainer.removeChild(iframe);\n\t},\n};","export default {\n\ton_created: function(iframe) {\n\t\tiframe.style.border = 'none';\n\t\tiframe.style.borderRadius = '5px';\n\t\tiframe.style.boxShadow = '0 0 10px 5px #888';\n\t},\n};","import * as layer_manager from './layer_manager.js';\n\nimport auto_sizing from './plugins/auto_sizing.js';\nimport auto_centering_layer from './plugins/auto_centering_layer.js';\nimport draggable from './plugins/draggable.js';\nimport edge_snapping_layer from './plugins/edge_snapping_layer.js';\nimport edge_snapping_buttons from './plugins/edge_snapping_buttons.js';\nimport exit_on_escape from './plugins/exit_on_escape.js';\nimport focus_management from './plugins/focus_management.js';\nimport full_layer from './plugins/full_layer.js';\nimport shadow_border from './plugins/shadow_border.js';\n\n// Plugin combining\n/////////////////////////////////////////////////////////////////\nfunction execute_all(plugins, function_name) {\n\tvar functions = plugins.map(\n\t\tfunction(plugin) {return plugin[function_name]}\n\t).filter(Boolean);\n\treturn function() {\n\t\tfor (var i = 0; i < functions.length; i++) {\n\t\t\ttry {\n\t\t\t\tfunctions[i].apply(null, arguments);\n\t\t\t} catch(e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t}\n\t}\n}\nfunction get_first_defined(plugins, property) {\n\tfor (var i = 0; i < plugins.length; i++) {\n\t\tif (property in plugins[i] && typeof plugins[i][property] !== 'undefined') {\n\t\t\treturn plugins[i][property];\n\t\t}\n\t}\n}\nfunction combine_plugins(...plugins) {\n\t/*\n\t\tGiven an array of plugins, create a single plugin with all methods implemented.\n\t*/\n\treturn {\n\t\t/*\n\t\t\tAt least one plugin must define this.\n\t\t\tMust accept container element and return an iframe element.\n\t\t\tThe iframe must be inserted into the container, possibly with wrapper elements.\n\t\t*/\n\t\tcreate: get_first_defined(plugins, 'create'),\n\t\t/*\n\t\t\tAt least one plugin must deine this.\n\t\t\tMust take the iframe as an argument and remove it from the dom.\n\t\t\tIt doesn't need to remove it synchronously - it may, for example, animate it off-screen and then remove it.\n\t\t*/\n\t\tremove: get_first_defined(plugins, 'remove'),\n\n\t\t/* \n\t\t\tIf set, close the layer when the user clicks anywhere outside of the iframe\n\t\t*/\n\t\texit_on_external_click: get_first_defined(plugins, 'exit_on_external_click'),\n\t\t/*\n\t\t\tWhether or not to lock the scroll position of the document while this layer is open\n\t\t\tFull-page layers will probably want to set it, others may or may not\n\t\t*/\n\t\tlock_scroll: get_first_defined(plugins, 'lock_scroll'),\n\n\t\t/*\n\t\t\tCallbacks - pretty self explanatory.\n\t\t\tEach is called with iframe as the sole argument, with the exception of:\n\t\t\t\ton_load(iframe, first_load) -> first_load is boolean, true if this is the first page load\n\t\t\t\ton_resolve(value, iframe) -> value is whatever value was passed to frame_stacker.resolve()\n\t\t*/\n\t\ton_created: execute_all(plugins, 'on_created'),\n\t\ton_load: execute_all(plugins, 'on_load'),\n\t\ton_covered: execute_all(plugins, 'on_covered'),\n\t\ton_resumed: execute_all(plugins, 'on_resumed'),\n\t\ton_resolve: execute_all(plugins, 'on_resolve'),\n\t}\n}\nfunction validate(plugin) {\n\tif (!plugin.create || !plugin.remove) {\n\t\tthrow new Error('You must pass at least one plugin that implements create() and one plugin that implements remove() to frame_stacker.push(). We generally recommend starting with frame_stacker.full_layer or frame_stacker.auto_layer.');\n\t}\n}\n\nwindow.frame_stacker = {\n\tpush: function(url, ...plugins) {\n\t\t// prepend a fixed set of plugins, which are always used\n\t\tplugins = [focus_management].concat(plugins);\n\n\t\tconst plugin = combine_plugins(...plugins);\n\t\tvalidate(plugin);\n\n\t\t// TODO - document the returned promise (or should we just drop it altogether?)\n\t\treturn layer_manager.push(url, plugin);\n\t},\n\t// Note - value is optional, and will be passed to the on_resove() callback\n\tresolve: function(value) {\n\t\treturn layer_manager.resolve(value);\n\t},\n\n\t// End users may want to call this to combine a commonly used set of plugins \n\tcombine_plugins: combine_plugins,\n\n\t// Most of the time, you'll use one of these as your \"base\" plugin\n\tfull_layer: full_layer,\n\tauto_layer: combine_plugins(\n\t\tauto_centering_layer, \n\t\tauto_sizing, \n\t\tshadow_border\n\t),\n\tedge_snapping_layer: edge_snapping_layer,\n\n\t// other plugins you may want to use:\n\tauto_centering_layer: auto_centering_layer,\n\tauto_sizing: auto_sizing,\n\tdraggable: draggable,\n\teasy_exit: combine_plugins(\n\t\texit_on_escape, \n\t\t{exit_on_external_click: true},\n\t),\n\tedge_snapping_buttons: edge_snapping_buttons,\n\texit_on_escape: exit_on_escape,\n\tshadow_border: shadow_border,\n};"]}