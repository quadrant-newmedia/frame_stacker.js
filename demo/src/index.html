<!DOCTYPE html>
<html>
<head>
    <title>Window Layers Tests</title>

    <script type="text/javascript">
        window.src_mode = /demo\/src\/$/.test(location.pathname)

        if (src_mode) {
            // include src script, as js module
            document.write('<script type="module" src="/src/frame_stacker.js"><\/script>');
        }
        else {
            // we use parcel.js to bundle our code
            // the bundles that parcel produces do NOT work in strict mode
            // therefore, we must load this a regular script, NOT module
            document.write('<script defer src="/dist/frame_stacker.js"><\/script>');
        }
    </script>

    <link rel="stylesheet" type="text/css" href="./style.css">
    <script defer src="/test_utils.js"></script>

    <style>
        body {
            background-color: white;
        }
        .EdgeSnapperBar {
            position: sticky;
            top: 0;
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #aaa;
            background-color: white;
        }
        .EdgeSnapperBar > button {
            margin: 5px;
        }

    </style>
</head>
<body>
    <aside>Testing 
        <script>
            if (src_mode) {
                document.write('src code. <a href="/demo/dist/">Test dist code</a>.');
            }
            else {
                document.write('dist code. <a href="/demo/src/">Test src code</a>.');
            }
        </script>
        <a href="https://github.com/quadrant-newmedia/frame_stacker.js">View on GitHub</a>.
    </aside>

    <h1>frame_stacker.js</h1>

    <p>A helper library for managing iframe-based modal dialogs/overlays (hereinafter known as "frames"). Frames are managed in a stack-like manner. Only the top-most frame is interactive.</p>

    <h2>Installation</h2>
    <p>
        Get the latest release: <br>
        <code>
    curl -L -O https://unpkg.com/frame_stacker/dist/frame_stacker.js</code>
    </p>
    <p>Add the script to your page and you're good to go.</p>

    <h2>Documentation</h2>
    <p>The <a href="https://github.com/quadrant-newmedia/frame_stacker.js">source code</a> serves as the official documentation. We recommend cloning and reading your local copy: <br>
    <code>git clone --depth 1 https://github.com/quadrant-newmedia/frame_stacker.js.git</code></p>
    <!-- TODO - make repo public, test -->

    <h2>Demo</h2>  
    <p>
        This page serves as the demo/test page. Most of the buttons on this page use in-line click handlers, and display the value of that handler right in the button.
    </p>

    <p>
        <br>On this page, to make the examples more succinct, we've set
        <code>window.fs = window.frame_stacker;</code>
    </p>

    <h2>Accessibility / Usability</h2>
    <p>We aim to implement all of the accessibility features outlined on <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/dialog_role">Mozilla's article about the ARIA "dialog" role.</a></p>
    <ul>
        <li>When pushing an iframe, that iframe is focused within the parent page.</li>
        <li>When an iframe page loads, the first element with the <code>autofocus</code> attribute will be given focus within the iframe.</li>
        <li>Keyboard focus is trapped in the top-most frame.</li>
        <li>Keyboard focus is restored after resolving a frame (whichever element had focus before the frame was pushed will be refocused when it is closed).</li>
        <li>Click events outside the top-most frame are blocked.</li>
        <li>The iframe automatically gets <code>role="dialog"</code> and <code>aria-lable</code> attributes. The <code>aria-label</code> attribute's value comes from the <code>&lt;title&gt;</code> of the iframe's document.</li>
    </ul>
    <p>TODO:</p>
    <ul>
        <li>screen reader testing</li>
        <li>see if we can tell browser extensions like Vimium not to create "hints" for any element outside of the top-most frame.</li>
    </ul>
    <!-- iframe will try to focus this element -->
    <input type="text" placeholder="DUMMY ELEMENT" id="parent_focus_test_element">
    <button id="focus_test_button" onclick="fs.push('./focus_test.html', tests.big_layer)" demo-button></button>
    <button onclick="fs.push('./focus_test.html', fs.full_layer)" demo-button></button>


    <h2>full_layer</h2>
    <button onclick="fs.push('./full_layer.html', fs.full_layer)" demo-button></button>
    <h2>auto_layer</h2>


    <h2>TODO</h2>


    <p>
        <button onclick="fs.push('./basic_close.html', fs.full_layer)" demo-button></button>
        <br>
    </p>

    <h2>Plugins</h2>
    <p>Rather than taking a single configuration object, frame_stacker.push() accepts one or more configuration objects, which we refer to as "plugins". 

    <p>You've already seen two plugins in use - <code>frame_stacker.auto_layer</code>

    <p>Refer to <a href="/src/combine_plugins.js">combine_plugins.js</a> for a list of available plugin options.</p>

    <p>Multiple plugins can be combined into a single, reusable plugin via <code>frame_stacker.combine_plugins(plugin1, plugin2, ...)</code>. Several of the standard plugins we export are created this way.



<hr>
    <h2>Basic Usage</h2>
    <p>Call <code>frame_stacker.push(url, plugin, other_plugin, ...)</code> to create a new frame.</p>
    <p>Call <code>frame_stacker.resolve()</code> to close the frame (the <a href="#communication">communication section</a> discusses why we use the term "resolve" rather than "pop"). 
    <p>Note that the global <code>frame_stacker</code> object will be copied to the iframe's window. You do not need to include frame_stacker.js inside the iframe, but you can still call <code>frame_stacker.resolve()</code> from inside the iframe.</p>
    <button data-display-onclick onclick="fs.push('./basic_close.html', fs.full_layer);">Open Frame</button>

        TODO
    </p>


    <h2 id="communication">Inter-window communication</h2>

    <h2>Nesting</h2>




    <p>Frames are nestable. </p>

    <h2>Basic/Full Layer Tests</h2>
    <p>
        <button onclick="fs.push('./basic_full_layer.html', fs.full_layer)">
            Open Full Layer Modal
        </button>
    </p>

    <h2>Auto-Layer</h2>
    Resize the textare inside the iframe and verify that:
    <ul>
        <li>Height is bounded (and respects the "wrapper_padding" value passed to auto_centering_layer)</li>
        <li>Width is bounded (and respects the "wrapper_padding" value passed to auto_centering_layer)</li>
        <li>Iframe shifts toward top of viewport when small - looks more balanced that way, closer to how alert() windows look</li>
        <li>You can click outside the iframe, or press escape, to exit</li>
    </ul>
    <p>
        <button onclick="fs.push('./user_sizable.html', fs.auto_layer, fs.easy_exit)">Open auto-layer</button>
    </p>

    <h2>Edge-snapping layer</h2>
    <p>
        <button data-display-onclick onclick="
            fs.push(
                '.', 
                fs.edge_snapping_layer, 
                fs.edge_snapping_buttons,
                fs.shadow_border,
                fs.easy_exit,
            )">Open edge-snapping layer</button>
    </p>

    <h2>Draggable Test</h2>
    Verify that:
    <ul>
        <li>You can drag the window (with mouse or touch screen)</li>
        <li>The window is cannot be moved out of the viewport</li>
        <li>You have to start the drag from the target</li>
    </ul>
    <p>
        <button onclick="fs.push('./draggable.html', fs.auto_centering_layer, fs.shadow_border, fs.draggable, fs.easy_exit)">Open Draggable Window</button>
    </p>


    <div style="width: 400px;">
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
        quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
        cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>
</body>
</html>